<style>
    #revMode {
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-self: center;
        flex-direction: column;
        gap: 1rem;
        width: 100vw;
        height: 100vh;
        padding: 4rem;
        padding-bottom: 8rem;

        #title {

            font-size: calc(var(--font-size) * 0.8);

            @media (width < 768px) {
                font-size: calc(var(--font-size)*1.8);
            }
        }

        #opts-con {
            margin-top: auto;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;

            .top-txt {
                color: #a6a6a6;
            }

            .top,
            .bottom {
                margin: 1rem auto;
                display: flex;
                gap: 1rem;
            }

            .top button {
                width: 3rem;
                font-family: 'inter', 'Sans-serif';
                padding: 0;
                height: 3rem;

                @media (width < 768px) {
                    font-size: calc(var(--font-size)*1.6);
                }
            }

            hr {
                width: 100%;
            }

            .bottom {
                gap: 2rem;
            }

            .svg-btn {
                color: var(--color);
                background-color: transparent;
                --svg-wh: 3rem;

                &:hover {
                    background-color: var(--muted);
                    color: var(--bg);
                }
            }

        }

        #selectCustomAfterDailouge {
            border: 1px solid #ccc;
            border-radius: var(--border-radious);
            width: 90vw;
            max-width: 400px;

            padding: 0;

            &::backdrop {
                background-color: rgba(0, 0, 0, 0.5);
                touch-action: none;
            }


            .mc {
                box-sizing: border-box;
                background-color: var(--bg);
                color: var(--color);
                padding: 2rem;
                display: flex;
                flex-direction: column;
            }

            .con {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin: 0.5rem 0;

                &:last-of-type {
                    margin-bottom: 0;
                    margin-top: 1rem;
                }
            }

            input {
                display: block;
                width: 100%;
                font-family: 'inter';
                direction: ltr;
                text-align: left;
                flex-grow: 2;
            }

            select {
                font-family: 'inter';
            }

            .btn:last-of-type {
                margin-right: 0.8rem;
                background-color: var(--muted);
                color: var(--bg);
            }
        }
    }
</style>
<div id="revMode">
    {{if .RD.Title}}
    <div id="title">{{.RD.Title}}</div>

    <dialog id="selectCustomAfterDailouge">
        <div class="mc">
            <div class="con">
                <label for="selectCustomAfterDailougeSelect">الأيام:</label>
                <select name="selectCustomAfterDailougeSelect" id="selectCustomAfterDailougeSelect">
                    <option value="7">7</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="25">25</option>
                    <option value="30">30</option>
                </select>
            </div>
            <div class="con">
                <label for="selectCustomAfterDailougeInput">أو:</label>
                <!-- <input class="input-style" id="selectCustomAfterDailougeInput" type="number" placeholder="1-30" min="1"
                    max="30"> -->
                <input class="input-style" id="selectCustomAfterDailougeInput" placeholder="1-30" inputmode="numeric" />
            </div>
            <div class="con">
                <button class="btn" style="flex-grow: 2;" onclick="customAfter()" autofocus>
                    موافق
                </button>
                <button class="btn" onclick="selectCustomAfterDailouge.close()">
                    إلغاء
                </button>
            </div>
        </div>
    </dialog>

    <div id="opts-con">
        <div class="right">
        </div>
        <!-- <button class="btn" onclick="window.location.reload()">
                next
            </button> -->

        <div class="top-txt">
            بعد عدد الأيام
        </div>
        <div class="top">
            <button class="btn" onclick="showAfter(1)">
                1
            </button>
            <button class="btn" onclick="showAfter(3)">
                3
            </button>
            <button class="btn" onclick="showAfter(5)">
                5
            </button>
            <button class="btn" onclick="customAfterInput.value = ''; selectCustomAfterDailouge.showModal()">
                -
            </button>
        </div>
        <hr>
        <div class="bottom">
            <button class="svg-btn {{if (eq .HiIdx.Peras.MatchCound 0)}}hidden{{end}}"
                onclick="readerWrapper.classList.toggle('hidden'); readerWrapper.scrollIntoView({ behavior: 'smooth'});">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-eye-slash-fill"
                    viewBox="0 0 16 16">
                    <path
                        d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94" />
                </svg>

            </button>
            <button class="svg-btn" onclick="dontShow()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-eye-slash-fill"
                    viewBox="0 0 16 16">
                    <path
                        d="m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7 7 0 0 0 2.79-.588M5.21 3.088A7 7 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474z" />
                    <path
                        d="M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12z" />
                </svg>
            </button>
            <button class="svg-btn" onclick="alert('Not yet implimented! it should go undo the previous thing')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-eye-slash-fill"
                    viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z" />
                    <path
                        d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466" />
                </svg>
            </button>
        </div>
    </div>
    {{else}}
    <p>
        لا جديد موجود
    </p>
    <!-- <button class="btn" onclick="reset()">
        reset
    </button> -->
    {{end}}
</div>

<script>
    const word = "{{.RD.Title}}";
    const selectCustomAfterDailouge = document.getElementById("selectCustomAfterDailouge");
    const customAfterSelect = document.getElementById("selectCustomAfterDailougeSelect")
    const customAfterInput = document.getElementById("selectCustomAfterDailougeInput")

    function showAfter(days) {
        postThen(`${window.location.pathname}?w=${word}&after=${days}`,
            () => window.location.reload());
    }

    customAfterInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter")
            customAfter();
    });

    customAfterSelect.addEventListener("change",
        () => customAfterInput.value = "");

    function customAfter() {
        let val = customAfterInput.value.trim();
        val = val ? val : customAfterSelect.value;
        const days = parseInt(val);

        if (days < 0 || days > 30 || isNaN(days) || !/^[0-9]+$/.test(val)) {
            alert(`Error: Invalid number of days provided (range 1-30): '${val}'`);
            return;
        }
        selectCustomAfterDailouge.close();
        showAfter(days);
    }

    function dontShow() {
        if (confirm(`هل تريد إخفاء: ${word}`))
            postThen(`${window.location.pathname}?w=${word}&dontshow=true`,
                () => window.location.reload())
    }

    function postThen(url, func) {
        fetch(url, { method: "POST" })
            .then(((res) => {
                if (res.ok) { if (func) func(); }
            })).catch((err) => {
                console.error(err);
                alert("Something went wrong (check console)");
            });
    }
</script>