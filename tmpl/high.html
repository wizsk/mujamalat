<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/pub/fav.png" type="image/x-icon">
    <title>الكلمات المميزات</title>

    <script src="/pub/js/reader_info.js" defer></script>
    <link rel="stylesheet" href="/pub/styles/note.css">

    {{template "common-css"}}
    <style>
        * {box-sizing: border-box;}
        body {
            width: 98vw;
            max-width: 500px;
            padding: 0.5rem;
            margin-bottom: 4rem;
        }

        h3 {
            margin: 1rem 0;
        }

        hr {
            border: 0;
            border-top: 1px solid #ccc;
        }

        #word-list {
            width: 100%;
        }

        .dash {
            padding-right: 0.4rem;
        }

        .word {
            padding: 0.4rem 0;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .word-span {
            flex: 1;
            color: inherit;
            text-decoration: none;

            &:hover {
                color: var(--accent);
            }
        }

        .word:nth-child(2n) {
            background-color: #cccccc1c;
        }


        .del, .note, .dict-link > button {
            all: unset;
            user-select: none;
            cursor: pointer;
            background-color: none;
            padding: 0;
            --btn-wh: 2.5rem;
            width: var(--btn-wh);
            height: var(--btn-wh);
            border-radius: var(--border-radious);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: auto;
            /* box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15); */

            svg {
                --svg-wh: 1.5rem;
                width: var(--svg-wh);
                height: var(--svg-wh);
            }
        }

        .dict-link {
            color: var(--accent);
            text-decoration: none;

            &:hover {
                color: var(--accent-dark);
            }

            button {
                color: inherit;
            }
        }

        .note {
            color: var(--accent);
            &:hover {
                color: var(--accent-dark);
            }
        }

        .del {
            color: var(--muted);
            &:hover {
                color: var(--muted-dark);
            }
        }
    </style>
</head>

<body>

    <h3>الكلمات المميزة {{if .Words}}({{len .Words | arnum}}){{end}}</h3>
    <hr>
    <div id="word-list">
        {{range .Words}}
        <div class="word">
            <span class="dash">-</span>

            <a class="word-span" href="/rd/highlist/{{.Oar}}">{{.Oar}} «{{.Count | arnum}}»</a>

            <a href="/?w={{.Oar}}" target="_blank" class="dict-link">
                <button type="button" class="link-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                        <!--no fill-->
                        <!--<path fill-rule="evenodd" d="M4.475 5.458c-.284 0-.514-.237-.47-.517C4.28 3.24 5.576 2 7.825 2c2.25 0 3.767 1.36 3.767 3.215 0 1.344-.665 2.288-1.79 2.973-1.1.659-1.414 1.118-1.414 2.01v.03a.5.5 0 0 1-.5.5h-.77a.5.5 0 0 1-.5-.495l-.003-.2c-.043-1.221.477-2.001 1.645-2.712 1.03-.632 1.397-1.135 1.397-2.028 0-.979-.758-1.698-1.926-1.698-1.009 0-1.71.529-1.938 1.402-.066.254-.278.461-.54.461h-.777ZM7.496 14c.622 0 1.095-.474 1.095-1.09 0-.618-.473-1.092-1.095-1.092-.606 0-1.087.474-1.087 1.091S6.89 14 7.496 14"/>
                        </svg>-->
                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247m2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/>
                    </svg>
                </button>
            </a>

            <button class="note" onclick="showInfoModal('{{.Oar}}')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M10.646.646a.5.5 0 0 1 .708 0l4 4a.5.5 0 0 1 0 .708l-1.902 1.902-.829 3.313a1.5 1.5 0 0 1-1.024 1.073L1.254 14.746 4.358 4.4A1.5 1.5 0 0 1 5.43 3.377l3.313-.828zm-1.8 2.908-3.173.793a.5.5 0 0 0-.358.342l-2.57 8.565 8.567-2.57a.5.5 0 0 0 .34-.357l.794-3.174-3.6-3.6z" />
                    <path fill-rule="evenodd" d="M2.832 13.228 8 9a1 1 0 1 0-1-1l-4.228 5.168-.026.086z" />
                </svg>
            </button>
            <button data-oar="{{.Oar}}" class="del">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/>
                </svg>
            </button>
        </div>
        {{end}}
    </div>

    <dialog id="infoDialog">
        <div>
            <h3 id="noteWord"></h3>
            <textarea dir="auto" class="input-style" id="infoTxt" readonly placeholder="Write a note in English or Arabic"></textarea>
            <form method="dialog">
                <button class="btn btn-eng" type="button" style="flex-grow: 2; width: 100%;" id="infoEditBtn"></button>
                <button class="btn btn-eng" type="button" style="flex-grow: 1; background-color: var(--alert);" id="noteDelBtn">Delete</button>
                <button class="btn btn-eng" type="submit" style="flex-grow: 1; background-color: var(--muted);" id="infoCloseBtn">Close</button>
            </form>
        </div>
    </dialog>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            window.localStorage.getItem("dark") && document.documentElement.classList.add("dark");
        });
        const wordList = document.getElementById("word-list");
        const del = document.getElementsByClassName("del");
        for (let i = 0; i < del.length; i++) {
            const btn = del[i];

            btn.onclick =
                async () => {
                    const hWord = btn.dataset.oar;

                    if (!confirm(`هل تريد أن تسمح: ${hWord}`)) return;

                    let msg = "&del=true";

                    console.log(`/rd/high?w=${hWord}${msg}`);
                    fetch(`/rd/high?w=${hWord}${msg}`, { method: "POST" })
                        .then((res) => {
                            if (res.status === 202) {
                                wordList.removeChild(btn.parentElement);
                            } else {
                                alert(`Couldn't save/del highlight: ${hWord}`);
                            }
                        })
                        .catch((err) => {
                            alert(`Couldn't save/del highlight: ${hWord}`);
                            console.error(err)
                        });
                }
        }
    </script>
</body>

</html>
